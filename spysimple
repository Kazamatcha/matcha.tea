-- LocalScript trong StarterPlayerScripts

local Players = game:GetService("Players")
local StarterCharacterScripts = game:GetService("StarterPlayer"):WaitForChild("StarterCharacterScripts")
local player = Players.LocalPlayer

-- GUI
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.Name = "CharScriptsViewer"

local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0, 400, 0, 400)
Frame.Position = UDim2.new(0, 50, 0, 100)
Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Frame.BorderSizePixel = 0

local Title = Instance.new("TextLabel", Frame)
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Text = "StarterCharacterScripts Viewer"
Title.TextColor3 = Color3.new(1,1,1)
Title.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
Title.BorderSizePixel = 0
Title.Font = Enum.Font.SourceSansBold
Title.TextSize = 18

local Scrolling = Instance.new("ScrollingFrame", Frame)
Scrolling.Size = UDim2.new(1, -10, 1, -40)
Scrolling.Position = UDim2.new(0, 5, 0, 35)
Scrolling.CanvasSize = UDim2.new(0,0,0,0)
Scrolling.ScrollBarThickness = 6
Scrolling.BackgroundTransparency = 1

local UIListLayout = Instance.new("UIListLayout", Scrolling)
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0,2)

-- copy path
local function getFullPath(obj)
    local path = obj.Name
    local parent = obj.Parent
    while parent and parent ~= game do
        path = parent.Name .. "." .. path
        parent = parent.Parent
    end
    return "game."..path
end

-- table để lưu trạng thái folder mở/đóng
local folderStates = {}

-- tạo button
local function createButton(obj, indent)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -10, 0, 25)
    btn.TextXAlignment = Enum.TextXAlignment.Left
    btn.Text = string.rep("   ", indent) .. obj.Name .. " ("..obj.ClassName..")"
    btn.TextColor3 = Color3.new(1,1,1)
    btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    btn.BorderSizePixel = 0
    btn.Font = Enum.Font.SourceSans
    btn.TextSize = 16

    if obj:IsA("Folder") then
        btn.MouseButton1Click:Connect(function()
            folderStates[obj] = not folderStates[obj]
            refreshList()
        end)
    else
        btn.MouseButton1Click:Connect(function()
            setclipboard(getFullPath(obj)) -- copy path
        end)
    end

    return btn
end

-- hàm vẽ danh sách
function refreshList()
    for _,v in ipairs(Scrolling:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end

    local function addChildren(parent, indent)
        for _,child in ipairs(parent:GetChildren()) do
            local btn = createButton(child, indent)
            btn.Parent = Scrolling

            -- nếu là folder và đang mở thì vẽ thêm con
            if child:IsA("Folder") and folderStates[child] then
                addChildren(child, indent+1)
            end
        end
    end

    addChildren(StarterCharacterScripts, 0)
    Scrolling.CanvasSize = UDim2.new(0,0,0,UIListLayout.AbsoluteContentSize.Y+10)
end

-- cập nhật khi thay đổi
StarterCharacterScripts.ChildAdded:Connect(refreshList)
StarterCharacterScripts.ChildRemoved:Connect(refreshList)

refreshList()


--// ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "InfoGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = game:GetService("CoreGui")

--// Frame chính (kéo thả, size cố định lúc đầu, sẽ tăng khi thêm dòng)
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 240)
frame.Position = UDim2.new(0, 30, 0, 200)
frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

-- Hàm tạo dòng có Label + Button
local function createRow(yPos, defaultText)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -80, 0, 30)
    label.Position = UDim2.new(0, 10, 0, yPos)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 16
    label.Font = Enum.Font.SourceSansBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextWrapped = true
    label.Text = defaultText
    label.Parent = frame

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 60, 0, 25)
    button.Position = UDim2.new(1, -70, 0, yPos + 2)
    button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 14
    button.Font = Enum.Font.SourceSansBold
    button.Text = "Copy"
    button.Parent = frame

    return label, button
end

-- Các dòng mặc định
local idLabel, btn1 = createRow(5, "ID: " .. tostring(game.PlaceId))
local posLabel, btn2 = createRow(45, "Toạ độ: Đang lấy...")
local toolLabel, btn3 = createRow(85, "Tool: Không cầm gì")
local animLabel, btn4 = createRow(125, "Animation: Không có")

-- Nút copy ID
btn1.MouseButton1Click:Connect(function()
    local txt = tostring(game.PlaceId)
    if setclipboard then setclipboard(txt) elseif toclipboard then toclipboard(txt) end
    btn1.Text = "Đã copy!"
    task.wait(1)
    btn1.Text = "Copy"
end)

-- Nút copy tọa độ
btn2.MouseButton1Click:Connect(function()
    local char = game.Players.LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local p = char.HumanoidRootPart.Position
        local txt = string.format("%d, %d, %d", p.X, p.Y, p.Z)
        if setclipboard then setclipboard(txt) elseif toclipboard then toclipboard(txt) end
        btn2.Text = "Đã copy!"
        task.wait(1)
        btn2.Text = "Copy"
    end
end)

-- Nút copy tool
btn3.MouseButton1Click:Connect(function()
    local txt = toolLabel.Text
    if setclipboard then setclipboard(txt) elseif toclipboard then toclipboard(txt) end
    btn3.Text = "Đã copy!"
    task.wait(1)
    btn3.Text = "Copy"
end)

-- Nút copy animation
btn4.MouseButton1Click:Connect(function()
    local txt = animLabel.Text
    if setclipboard then setclipboard(txt) elseif toclipboard then toclipboard(txt) end
    btn4.Text = "Đã copy!"
    task.wait(1)
    btn4.Text = "Copy"
end)

-- Liệt kê tất cả RemoteEvent trong ReplicatedStorage (chỉ thực hiện 1 lần)
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local remotes = {}
for _, obj in ipairs(ReplicatedStorage:GetDescendants()) do
    if obj:IsA("RemoteEvent") then
        table.insert(remotes, obj)
    end
end

-- Tạo dòng cho từng RemoteEvent
local startY = 165
local currentY = startY

for i, remote in ipairs(remotes) do
    local label, btn = createRow(currentY, "RemoteEvent: " .. remote.Name)

    btn.MouseButton1Click:Connect(function()
        local full = remote:GetFullName()
        if setclipboard then setclipboard(full) elseif toclipboard then toclipboard(full) end
        btn.Text = "Đã copy!"
        task.wait(1)
        btn.Text = "Copy"
    end)

    currentY = currentY + 40
end

-- Tăng chiều cao frame nếu cần
local neededHeight = currentY + 10
if neededHeight > frame.Size.Y.Offset then
    frame.Size = UDim2.new(0, 300, 0, neededHeight)
end

-- Cập nhật liên tục các dòng động
game:GetService("RunService").RenderStepped:Connect(function()
    local player = game.Players.LocalPlayer
    local char = player.Character

    -- Tọa độ
    if char and char:FindFirstChild("HumanoidRootPart") then
        local p = char.HumanoidRootPart.Position
        posLabel.Text = string.format("Toạ độ: %d, %d, %d", p.X, p.Y, p.Z)
    end

    -- Tool
    local tool = char and char:FindFirstChildOfClass("Tool")
    if tool then
        toolLabel.Text = "Tool: " .. tool.Name
    else
        toolLabel.Text = "Tool: Không cầm gì"
    end

    -- Animation
    local animText = "Animation: Không có"
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    if hum then
        local tracks = hum:GetPlayingAnimationTracks()
        if #tracks > 0 then
            local track = tracks[1]
            local name = track.Name or "UnknownName"
            local animObj = track.Animation
            local animId = (animObj and animObj.AnimationId ~= "") and animObj.AnimationId or "Không có ID"
            animText = "Animation: " .. name .. " (" .. animId .. ")"
        end
    end
    animLabel.Text = animText
end)

-- Thêm nút Unload
local unloadButton = Instance.new("TextButton")
unloadButton.Size = UDim2.new(0, 100, 0, 30)
unloadButton.Position = UDim2.new(0, 100, 1, -40) -- Dưới cùng frame
unloadButton.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
unloadButton.TextColor3 = Color3.fromRGB(255, 255, 255)
unloadButton.TextSize = 16
unloadButton.Font = Enum.Font.SourceSansBold
unloadButton.Text = "Unload"
unloadButton.Parent = frame

unloadButton.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)


