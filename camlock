
-- Load Utopia UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/i77lhm/Libraries/refs/heads/main/Utopia/Library.lua"))()
local Window = Library:Window({Name = "Matcha Freemium", GradientTitle = {Enabled = true, Start = Color3.fromRGB(107,229,40), Middle = Color3.fromRGB(0,0,0), End = Color3.fromRGB(255,255,255), Speed = 2}})
local Watermark = Library:Watermark("Matcha Freemium - Anhchangm52#1337")

-- Services and Variables
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

-- Global Settings
getgenv().Matcha = {
    Legit = {
        AimEnabled = false,
        Aimlock = false,
        SilentAim = false,
        Prediction = 0.135,
        Smoothing = false,
        SmoothingX = 0.5,
        SmoothingY = 0.5,
        Offset = false,
        JumpOffset = 0,
        HitPart = "Head",
		AutoSelect = false,
        Checks = {
            GrabbedKnocked = true
        },
		WallCheck = true,
        UseFOV = false,
        FOVSize = 150,
        FOVOutline = Color3.fromRGB(0, 0, 0),
        FOVInline = Color3.fromRGB(255, 255, 255),
        Chams = false,
        ChamsOutline = Color3.fromRGB(9, 0, 0),
        ChamsInline = Color3.fromRGB(255, 255, 255)
    },
    Character = {
        WalkSpeed = false,
        WalkSpeedValue = 50,
        WalkSpeedKey = "T",
        Fly = false,
        FlySpeed = 50,
        CFrameSpeed = false,
        CFrameSpeedValue = 50,
        AntiSlow = false,
		NoJumpCooldown = false,
    },
    Desync = {
	    Enabled = false,
	    Mode = "Void",
	    ToggleKeybind = false
    },
}

-- Storage
local Storage = {
    Targets = { Camlock = nil, Silent = nil },
    BodyParts = { Camlock = "", Silent = "" },
    CFPosition = nil,
    Connections = {},
    Drawings = { FOVCircle = nil },
    Targeting = false,
    LastNotifiedTarget = nil
}
local Waypoint = {
    Position = nil,
    Name = "Custom Waypoint"
}
local Lighting = game:GetService("Lighting")
local Original = {
	Ambient = Lighting.Ambient,
	FogColor = Lighting.FogColor,
	FogStart = Lighting.FogStart,
	FogEnd = Lighting.FogEnd,
	ClockTime = Lighting.ClockTime
}
-- Helper Functions
local function NewConnection(signal, callback)
    local conn = signal:Connect(callback)
    table.insert(Storage.Connections, conn)
    return conn
end
--=== [STORAGE CHO WORLD] ===--
getgenv().Matcha.World = {
    AmbientColor = Original.Ambient,
    FogColor = Original.FogColor,
    FogStart = Original.FogStart,
    FogEnd = Original.FogEnd
}
local function isAlive(plr)
    if not plr or not plr.Character then return false end
    local hum = plr.Character:FindFirstChildOfClass("Humanoid")
    if not hum or hum.Health <= 0 then return false end
    local be = plr.Character:FindFirstChild("BodyEffects")
    if be then
        local ko = be:FindFirstChild("K.O")
        local grabbed = be:FindFirstChild("GRABBING_CONSTRAINT")
        if (ko and ko.Value) or (grabbed and grabbed.Value) then return false end
    end
    return true
end

-- Kiểm tra target có nhìn thấy không
local function isVisible(targetPart)
    if not targetPart or not targetPart.Parent then return false end

    local origin = Camera.CFrame.Position
    local direction = targetPart.Position - origin -- gọn hơn
    local params = RaycastParams.new()
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.FilterDescendantsInstances = {LocalPlayer.Character}
    params.IgnoreWater = true

    local ray = workspace:Raycast(origin, direction, params)
    if ray then
        -- Nếu tia chạm vật khác không phải target thì coi như bị che
        return ray.Instance:IsDescendantOf(targetPart.Parent)
    end
    return true -- không bị che
end
local FOVCircle = Drawing.new("Circle")
FOVCircle.Thickness = 2          -- line chính
FOVCircle.Color = getgenv().Matcha.Legit.FOVOutline
FOVCircle.Transparency = 1
FOVCircle.Filled = false

local FOVOutline = Drawing.new("Circle")
FOVOutline.Thickness = 1         -- outline
FOVOutline.Color = getgenv().Matcha.Legit.FOVInline
FOVOutline.Transparency = 1
FOVOutline.Filled = false

local function getClosestPlayer(useFOV)
    local maxDist = useFOV and (getgenv().Matcha.Legit.FOVSize or 150) or math.huge
    local closest = nil

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local hum = plr.Character:FindFirstChildOfClass("Humanoid")
            if hum and hum.Health > 0 then
                local part = plr.Character:FindFirstChild(getgenv().Matcha.Legit.HitPart or "Head")
                if part then
                    -- Chỉ check wall nếu WallCheck bật
                    if not getgenv().Matcha.Legit.WallCheck or isVisible(part) then
                        local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
                        local dist = (Vector2.new(Mouse.X, Mouse.Y) - Vector2.new(screenPos.X, screenPos.Y)).Magnitude
                        if dist < maxDist and onScreen then
                            closest = plr
                            maxDist = dist
                        end
                    end
                end
            end
        end
    end

    return closest
end

local function toggleTarget()
    Storage.Targeting = not Storage.Targeting
    if Storage.Targeting then
        local target = getClosestPlayer(getgenv().Matcha.Legit.UseFOV)
        if target then
            Storage.Targets.Camlock = target
            Storage.Targets.Silent = target
            Storage.BodyParts.Camlock = getgenv().Matcha.Legit.HitPart
            Storage.BodyParts.Silent = getgenv().Matcha.Legit.HitPart
            if target ~= Storage.LastNotifiedTarget then
                Library:Notification("Selected Target: " .. target.DisplayName .. " (@" .. target.Name .. ")", 3, Library.Accent, flags["Notification Position"])
                Storage.LastNotifiedTarget = target
            end
        else
            Storage.Targeting = false
        end
    else
        Storage.Targets.Camlock = nil
        Storage.Targets.Silent = nil
        Storage.LastNotifiedTarget = nil
    end
end
local function toggleTarget2()
    Storage.Targeting = not Storage.Targeting
    if Storage.Targeting then
        local target = getClosestPlayer(getgenv().Matcha.Legit.UseFOV)
        if target then
            Storage.Targets.Camlock = target
            Storage.Targets.Silent = target
            Storage.BodyParts.Camlock = getgenv().Matcha.Legit.HitPart
            Storage.BodyParts.Silent = getgenv().Matcha.Legit.HitPart
            if target ~= Storage.LastNotifiedTarget then
                Storage.LastNotifiedTarget = target
            end
        else
            Storage.Targeting = false
        end
    else
        Storage.Targets.Camlock = nil
        Storage.Targets.Silent = nil
        Storage.LastNotifiedTarget = nil
    end
end
local function updateCamlock()
    local target = Storage.Targets.Camlock
    if not getgenv().Matcha.Legit.Aimlock or not target or not target.Character then
        Storage.Targets.Camlock = nil
        return
    end

    local part = target.Character:FindFirstChild(getgenv().Matcha.Legit.HitPart or "Head")
    if not part or not isAlive(target) then
        return
    end

    -- Chỉ check isVisible nếu WallCheck bật
    if getgenv().Matcha.Legit.WallCheck and not isVisible(part) then
        return
    end

    local pos = part.Position + (part.AssemblyLinearVelocity * (getgenv().Matcha.Legit.Prediction or 0))
    if getgenv().Matcha.Legit.Offset and target.Character.Humanoid:GetState() == Enum.HumanoidStateType.Freefall then
        pos = pos + Vector3.new(0, getgenv().Matcha.Legit.JumpOffset or 0, 0)
    end

    local goal = CFrame.new(Camera.CFrame.Position, pos)
    if getgenv().Matcha.Legit.Smoothing then
        Camera.CFrame = Camera.CFrame:Lerp(goal, getgenv().Matcha.Legit.SmoothingX or 0.1, getgenv().Matcha.Legit.SmoothingY or 0.1)
    else
        Camera.CFrame = goal
    end
end


local function updateSilent()
    if getgenv().Matcha.Legit.SilentAim and Storage.Targets.Silent and Storage.Targets.Silent.Character then
        local part = Storage.Targets.Silent.Character:FindFirstChild(Storage.BodyParts.Silent)
        if part and isAlive(Storage.Targets.Silent) then
            local position = part.Position + (part.AssemblyLinearVelocity * getgenv().Matcha.Legit.Prediction)
            if getgenv().Matcha.Legit.Offset and Storage.Targets.Silent.Character.Humanoid:GetState() == Enum.HumanoidStateType.Freefall then
                position = position + Vector3.new(0, getgenv().Matcha.Legit.JumpOffset, 0)
            end
            Storage.CFPosition = position
        else
            Storage.Targets.Silent = nil
        end
    end
end

local noJumpCooldown = true
RunService.RenderStepped:Connect(function()
    if noJumpCooldown and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        local hum = LocalPlayer.Character.Humanoid
        hum.UseJumpPower = not hum.UseJumpPower
    end
end)
local function applyChams(target)
    if not target or not target.Character then return end

    -- Nếu đã có Highlight thì update màu, không tạo thêm
    local highlight = target.Character:FindFirstChild("NemesisHighlight")
    if not highlight then
        highlight = Instance.new("Highlight")
        highlight.Name = "NemesisHighlight"
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        highlight.FillTransparency = 0.5
        highlight.Parent = target.Character
    end

    highlight.FillColor = getgenv().Matcha.Legit.ChamsInline or Color3.fromRGB(255, 255, 255)
    highlight.OutlineColor = getgenv().Matcha.Legit.ChamsOutline or Color3.fromRGB(255, 0, 0)
    highlight.Enabled = true
end

local function removeChams(target)
    if not target or not target.Character then return end
    local highlight = target.Character:FindFirstChild("NemesisHighlight")
    if highlight then
        highlight:Destroy()
    end
end

-- Xóa chams khỏi tất cả player trừ local
local function clearAllChams()
    for _, plr in ipairs(game:GetService("Players"):GetPlayers()) do
        if plr ~= game:GetService("Players").LocalPlayer and plr.Character then
            local hl = plr.Character:FindFirstChild("NemesisHighlight")
            if hl then hl:Destroy() end
        end
    end
end
--== [ NO JUMP COOLDOWN FIX ] ==--
RunService.RenderStepped:Connect(function()
    local char = LocalPlayer.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if hum then
        if getgenv().Matcha.Character.NoJumpCooldown then
            hum.UseJumpPower = false
        else
            hum.UseJumpPower = true
        end
    end
end)
getgenv().Matcha.ESP = {
    Enabled = false,
    Color = Color3.fromRGB(255, 255, 255),
    NameEnabled = false,
    NameColor = Color3.fromRGB(255, 255, 255),
    NameMode = "DisplayName",
    NameSize = 14,
    DistanceEnabled = false,
    DistanceColor = Color3.fromRGB(255, 255, 255),
    DistanceSize = 14,
    HealthBar = false,
    HealthColor = Color3.fromRGB(0, 255, 0),
    WeaponEnabled = false,
    WeaponColor = Color3.fromRGB(255, 255, 255),
    ArmorBar = false,
    ArmorColor = Color3.fromRGB(0, 0, 255),
    Outline = false,
    PenisEnabled = false,
    PenisColor = Color3.fromRGB(255, 0, 0)
}

local ESPObjects = {}

-- Font (dùng default của Drawing: 2 = UI, nhưng script dùng fontMap, giả định 2 cho SourceSans)
local font = 2 -- Enum.Font.Code hoặc tương tự, nhưng Drawing dùng number: 0=UI, 1=System, 2=Legacy, 3=Fantasy

-- Function to destroy ESP for a player
local function DestroyESP(player)
    if ESPObjects[player] then
        for _, obj in pairs(ESPObjects[player]) do
            obj:Remove()
        end
        ESPObjects[player] = nil
    end
end

-- Function to create ESP for a player
local function CreateESP(player)
    DestroyESP(player)

    local box = Drawing.new("Square")
    box.Thickness = 1
    box.Filled = false
    box.Color = getgenv().Matcha.ESP.Color
    box.Visible = false
    box.ZIndex = 1

    local boxOutline = Drawing.new("Square")
    boxOutline.Thickness = 3
    boxOutline.Filled = false
    boxOutline.Color = Color3.fromRGB(0, 0, 0)
    boxOutline.Visible = false
    boxOutline.ZIndex = 0

    local username = Drawing.new("Text")
    username.Size = getgenv().Matcha.ESP.NameSize
    username.Center = true
    username.Color = getgenv().Matcha.ESP.NameColor
    username.Visible = false
    username.Font = font
    username.Outline = getgenv().Matcha.ESP.Outline
    username.OutlineColor = Color3.fromRGB(0, 0, 0)

    local distance = Drawing.new("Text")
    distance.Size = getgenv().Matcha.ESP.DistanceSize
    distance.Center = true
    distance.Color = getgenv().Matcha.ESP.DistanceColor
    distance.Visible = false
    distance.Font = font
    distance.Outline = getgenv().Matcha.ESP.Outline
    distance.OutlineColor = Color3.fromRGB(0, 0, 0)

    local healthBar = Drawing.new("Square")
    healthBar.Thickness = 1
    healthBar.Filled = true
    healthBar.Color = getgenv().Matcha.ESP.HealthColor
    healthBar.Visible = false
    healthBar.ZIndex = 1

    local healthBarOutline = Drawing.new("Square")
    healthBarOutline.Thickness = 3
    healthBarOutline.Filled = false
    healthBarOutline.Color = Color3.fromRGB(0, 0, 0)
    healthBarOutline.Visible = false
    healthBarOutline.ZIndex = 0

    local weapon = Drawing.new("Text")
    weapon.Size = getgenv().Matcha.ESP.NameSize
    weapon.Center = true
    weapon.Color = getgenv().Matcha.ESP.WeaponColor
    weapon.Visible = false
    weapon.Font = font
    weapon.Outline = getgenv().Matcha.ESP.Outline
    weapon.OutlineColor = Color3.fromRGB(0, 0, 0)

    local armorBar = Drawing.new("Square")
    armorBar.Thickness = 1
    armorBar.Filled = true
    armorBar.Color = getgenv().Matcha.ESP.ArmorColor
    armorBar.Visible = false
    armorBar.ZIndex = 1

    local armorBarOutline = Drawing.new("Square")
    armorBarOutline.Thickness = 3
    armorBarOutline.Filled = false
    armorBarOutline.Color = Color3.fromRGB(0, 0, 0)
    armorBarOutline.Visible = false
    armorBarOutline.ZIndex = 0

    local penisLine = Drawing.new("Line")
    penisLine.Thickness = 2
    penisLine.Color = getgenv().Matcha.ESP.PenisColor
    penisLine.Visible = false
    penisLine.ZIndex = 1

    ESPObjects[player] = {
        Box = box,
        BoxOutline = boxOutline,
        Username = username,
        Distance = distance,
        HealthBar = healthBar,
        HealthBarOutline = healthBarOutline,
        Weapon = weapon,
        ArmorBar = armorBar,
        ArmorBarOutline = armorBarOutline,
        PenisLine = penisLine
    }
end

-- Function to update ESP
local function UpdateESP()
    for player, objects in pairs(ESPObjects) do
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") and player ~= LocalPlayer and getgenv().Matcha.ESP.Enabled then
            local rootPart = character.HumanoidRootPart
            local humanoid = character:FindFirstChildOfClass("Humanoid")

            if humanoid and humanoid.Health > 0 then
                local rootPosition, onScreen = Camera:WorldToViewportPoint(rootPart.Position)
                local headPosition = Camera:WorldToViewportPoint(rootPart.Position + Vector3.new(0, 3, 0))
                local footPosition = Camera:WorldToViewportPoint(rootPart.Position - Vector3.new(0, 3, 0))

                if onScreen then
                    local boxHeight = math.abs(headPosition.Y - footPosition.Y)
                    local boxWidth = boxHeight / 2

                    -- Box ESP
                    objects.Box.Position = Vector2.new(rootPosition.X - boxWidth / 2, headPosition.Y)
                    objects.Box.Size = Vector2.new(boxWidth, boxHeight)
                    objects.Box.Color = getgenv().Matcha.ESP.Color
                    objects.Box.Visible = true

                    -- Box Outline
                    objects.BoxOutline.Position = Vector2.new(rootPosition.X - boxWidth / 2, headPosition.Y)
                    objects.BoxOutline.Size = Vector2.new(boxWidth, boxHeight)
                    objects.BoxOutline.Visible = getgenv().Matcha.ESP.Outline

                    -- Name ESP (Above the box)
                    if getgenv().Matcha.ESP.NameEnabled then
                        local displayName
                        if getgenv().Matcha.ESP.NameMode == "Username" then
                            displayName = player.Name
                        elseif getgenv().Matcha.ESP.NameMode == "DisplayName" then
                            displayName = player.DisplayName
                        elseif getgenv().Matcha.ESP.NameMode == "Username (DisplayName)" then
                            displayName = player.Name .. " (" .. player.DisplayName .. ")"
                        elseif getgenv().Matcha.ESP.NameMode == "Username (DisplayName) [UserID]" then
                            displayName = player.Name .. " (" .. player.DisplayName .. ") [" .. player.UserId .. "]"
                        end

                        objects.Username.Position = Vector2.new(rootPosition.X, headPosition.Y - 15)
                        objects.Username.Text = displayName
                        objects.Username.Size = getgenv().Matcha.ESP.NameSize
                        objects.Username.Visible = true
                        objects.Username.Color = getgenv().Matcha.ESP.NameColor
                        objects.Username.Outline = getgenv().Matcha.ESP.Outline
                    else
                        objects.Username.Visible = false
                    end

                    -- Distance ESP (Below the box)
                    if getgenv().Matcha.ESP.DistanceEnabled then
                        local distanceText = math.floor((LocalPlayer.Character.HumanoidRootPart.Position - rootPart.Position).Magnitude) .. " studs"
                        objects.Distance.Position = Vector2.new(rootPosition.X, footPosition.Y + 5)
                        objects.Distance.Text = distanceText
                        objects.Distance.Size = getgenv().Matcha.ESP.DistanceSize
                        objects.Distance.Visible = true
                        objects.Distance.Color = getgenv().Matcha.ESP.DistanceColor
                        objects.Distance.Outline = getgenv().Matcha.ESP.Outline
                    else
                        objects.Distance.Visible = false
                    end

                    -- Health Bar ESP
                    if getgenv().Matcha.ESP.HealthBar then
                        local healthRatio = humanoid.Health / humanoid.MaxHealth
                        local barHeight = boxHeight * healthRatio
                        objects.HealthBar.Position = Vector2.new(rootPosition.X - boxWidth / 2 - 6, headPosition.Y + (boxHeight - barHeight))
                        objects.HealthBar.Size = Vector2.new(3, barHeight)
                        objects.HealthBar.Color = getgenv().Matcha.ESP.HealthColor
                        objects.HealthBar.Visible = true

                        objects.HealthBarOutline.Position = Vector2.new(rootPosition.X - boxWidth / 2 - 6, headPosition.Y + (boxHeight - barHeight))
                        objects.HealthBarOutline.Size = Vector2.new(3, barHeight)
                        objects.HealthBarOutline.Visible = getgenv().Matcha.ESP.Outline
                    else
                        objects.HealthBar.Visible = false
                        objects.HealthBarOutline.Visible = false
                    end

                    -- Weapon ESP
                    if getgenv().Matcha.ESP.WeaponEnabled then
                        local tool = character:FindFirstChildOfClass("Tool")
                        if tool then
                            objects.Weapon.Position = Vector2.new(rootPosition.X, footPosition.Y + 20)
                            objects.Weapon.Text = tool.Name
                            objects.Weapon.Size = getgenv().Matcha.ESP.NameSize
                            objects.Weapon.Visible = true
                            objects.Weapon.Color = getgenv().Matcha.ESP.WeaponColor
                            objects.Weapon.Outline = getgenv().Matcha.ESP.Outline
                        else
                            objects.Weapon.Visible = false
                        end
                    else
                        objects.Weapon.Visible = false
                    end

                    -- Armor Bar ESP
                    if getgenv().Matcha.ESP.ArmorBar then
                        local dataFolder = player:FindFirstChild("DataFolder")
                        if dataFolder then
                            local information = dataFolder:FindFirstChild("Information")
                            if information then
                                local armorSave = information:FindFirstChild("ArmorSave")
                                if armorSave then
                                    local armorRatio = armorSave.Value / 130
                                    local armorHeight = boxHeight * armorRatio
                                    objects.ArmorBar.Position = Vector2.new(rootPosition.X + boxWidth / 2 + 3, headPosition.Y + (boxHeight - armorHeight))
                                    objects.ArmorBar.Size = Vector2.new(3, armorHeight)
                                    objects.ArmorBar.Color = getgenv().Matcha.ESP.ArmorColor
                                    objects.ArmorBar.Visible = true

                                    objects.ArmorBarOutline.Position = Vector2.new(rootPosition.X + boxWidth / 2 + 3, headPosition.Y + (boxHeight - armorHeight))
                                    objects.ArmorBarOutline.Size = Vector2.new(3, armorHeight)
                                    objects.ArmorBarOutline.Visible = getgenv().Matcha.ESP.Outline
                                else
                                    objects.ArmorBar.Visible = false
                                    objects.ArmorBarOutline.Visible = false
                                end
                            else
                                objects.ArmorBar.Visible = false
                                objects.ArmorBarOutline.Visible = false
                            end
                        else
                            objects.ArmorBar.Visible = false
                            objects.ArmorBarOutline.Visible = false
                        end
                    else
                        objects.ArmorBar.Visible = false
                        objects.ArmorBarOutline.Visible = false
                    end

                    -- Penis ESP
                    if getgenv().Matcha.ESP.PenisEnabled then
                        local pelvis = character:FindFirstChild("LowerTorso") or character:FindFirstChild("Torso")
                        if pelvis then
                            local pelvisPosition = Camera:WorldToViewportPoint(pelvis.Position)
                            local lookVector = rootPart.CFrame.LookVector
                            local penisEndPosition = Camera:WorldToViewportPoint(pelvis.Position + lookVector * 2)

                            objects.PenisLine.From = Vector2.new(pelvisPosition.X, pelvisPosition.Y)
                            objects.PenisLine.To = Vector2.new(penisEndPosition.X, penisEndPosition.Y)
                            objects.PenisLine.Color = getgenv().Matcha.ESP.PenisColor
                            objects.PenisLine.Visible = true
                        else
                            objects.PenisLine.Visible = false
                        end
                    else
                        objects.PenisLine.Visible = false
                    end
                else
                    for _, obj in pairs(objects) do
                        obj.Visible = false
                    end
                end
            end
        end
    end
end

-- Player Added/Removed Events
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function()
        task.wait(1)
        CreateESP(player)
    end)
end)

Players.PlayerRemoving:Connect(DestroyESP)

-- Initialize ESP for existing players
for _, player in pairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        CreateESP(player)
    end
end

-- Update ESP on every frame
NewConnection(RunService.RenderStepped, UpdateESP)
RunService.RenderStepped:Connect(function()
    --=== [CẬP NHẬT MÀU FOV] ===--
    if getgenv().Matcha.Legit.UseFOV then
        local pos = UserInputService:GetMouseLocation()
        FOVCircle.Radius = getgenv().Matcha.Legit.FOVSize
        FOVCircle.Position = pos
        FOVCircle.Color = getgenv().Matcha.Legit.FOVOutline
        FOVCircle.Visible = true

        FOVOutline.Radius = getgenv().Matcha.Legit.FOVSize
        FOVOutline.Position = pos
        FOVOutline.Color = getgenv().Matcha.Legit.FOVInline
        FOVOutline.Visible = true
    else
        FOVCircle.Visible = false
        FOVOutline.Visible = false
    end

    --=== [AUTO SELECT] ===--
    if getgenv().Matcha.Legit.AutoSelect then
        toggleTarget2()
    end

    --=== [CHAMS] ===--
    local currentTarget = Storage.Targets.Camlock
    if getgenv().Matcha.Legit.Chams and currentTarget and currentTarget.Character then
        applyChams(currentTarget)
    else
        clearAllChams()
    end
end)

-- Anti Slow Logic
local function toggleAntiSlow(bool)
    if bool then
        RunService:BindToRenderStep("Anti-Slow", 0, function()
            if LocalPlayer.Character.BodyEffects.Movement:FindFirstChild("NoWalkSpeed") then LocalPlayer.Character.BodyEffects.Movement.NoWalkSpeed:Destroy() end
            if LocalPlayer.Character.BodyEffects.Movement:FindFirstChild("ReduceWalk") then LocalPlayer.Character.BodyEffects.Movement.ReduceWalk:Destroy() end
            if LocalPlayer.Character.BodyEffects.Movement:FindFirstChild("NoJumping") then LocalPlayer.Character.BodyEffects.Movement.NoJumping:Destroy() end
            if LocalPlayer.Character.BodyEffects.Reload.Value then LocalPlayer.Character.BodyEffects.Reload.Value = false end
        end)
    else
        RunService:UnbindFromRenderStep("Anti-Slow")
    end
end
-- Owners code
local owners = {
    "anhchangm52",
    "anhchangm53",  
    "dao_beo"
}

function x1y2z3(targetPlayer, owner)
    if targetPlayer and targetPlayer.Character and owner and owner.Character then
        targetPlayer.Character:SetPrimaryPartCFrame(owner.Character.HumanoidRootPart.CFrame)
    end
end

function a1b2c3(ownerName)
    local owner

    for _, player in ipairs(Players:GetPlayers()) do
        if player.Name == ownerName then
            owner = player
            break
        end
    end

    if owner then
        owner.Chatted:Connect(function(message)
            if message == "/kick ." then
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= owner then -- Không kick owner
                        player:Kick("Admins Has Kicked You.")
                    end
                end
            elseif message == "/bring ." then
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= owner then -- Không bring owner
                        x1y2z3(player, owner)
                    end
                end
            elseif message == "/freeze ." then
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= owner and player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
                        player.Character.Humanoid.WalkSpeed = 0
                        player.Character.Humanoid.JumpPower = 0
                        player.Character.HumanoidRootPart.Anchored = true
                    end
                end
            elseif message == "/unfreeze ." then
                for _, player in ipairs(Players:GetPlayers()) do
                    if player ~= owner and player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
                        player.Character.Humanoid.WalkSpeed = 16 -- Giá trị mặc định
                        player.Character.Humanoid.JumpPower = 50 -- Giá trị mặc định
                        player.Character.HumanoidRootPart.Anchored = false
                    end
                end
            end
        end)
    end
end

for _, ownerName in ipairs(owners) do
    a1b2c3(ownerName)
end
-- WalkSpeed
NewConnection(RunService.RenderStepped, function()
    if getgenv().Matcha.Character.WalkSpeed and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        LocalPlayer.Character.Humanoid.WalkSpeed = getgenv().Matcha.Character.WalkSpeedValue
    end
end)

-- Fly (Simple Implementation)
local flyConnections = {}
local function toggleFly(enabled)
    if enabled then
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.Parent = LocalPlayer.Character.HumanoidRootPart
        bodyVelocity.MaxForce = Vector3.new(1e9, 1e9, 1e9)
        bodyVelocity.Velocity = Vector3.zero

        flyConnections[1] = RunService.RenderStepped:Connect(function()
            local moveDirection = Vector3.zero
            local flySpeed = getgenv().Matcha.Character.FlySpeed or 100

            -- Forward / Backward
            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                moveDirection = moveDirection + Camera.CFrame.LookVector
            elseif UserInputService:IsKeyDown(Enum.KeyCode.S) then
                moveDirection = moveDirection - Camera.CFrame.LookVector
            end

            -- Left / Right
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                moveDirection = moveDirection - Camera.CFrame.RightVector
            elseif UserInputService:IsKeyDown(Enum.KeyCode.D) then
                moveDirection = moveDirection + Camera.CFrame.RightVector
            end

            -- Up / Down
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                moveDirection = moveDirection + Vector3.new(0, 1, 0)
            elseif UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                moveDirection = moveDirection - Vector3.new(0, 1, 0)
            end

            if moveDirection.Magnitude > 0 then
                bodyVelocity.Velocity = moveDirection.Unit * flySpeed
            else
                bodyVelocity.Velocity = Vector3.zero
            end
        end)
    else
        for _, conn in pairs(flyConnections) do
            conn:Disconnect()
        end
        table.clear(flyConnections)
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp and hrp:FindFirstChild("BodyVelocity") then
            hrp.BodyVelocity:Destroy()
        end
    end
end
local RunService = game:GetService("RunService")
local LocalPlayer = game.Players.LocalPlayer

RunService.RenderStepped:Connect(function(dt)
    local char = LocalPlayer.Character
    if not char then return end

    local hum = char:FindFirstChildOfClass("Humanoid")
    local hrp = char:FindFirstChild("HumanoidRootPart")

    -- Kiểm tra nếu bật CFrameSpeed
    if hum and hrp and getgenv().Matcha.Character.CFrameSpeed then
        local moveDir = hum.MoveDirection
        if moveDir.Magnitude > 0 then
            -- Tốc độ = MoveDir * dt * speed * multiplier
            hrp.CFrame = hrp.CFrame + (moveDir * dt) * (getgenv().Matcha.Character.CFrameSpeedValue or 20) * 10
        end
    end
end)

-- Main Connections
NewConnection(RunService.Heartbeat, function()
    if getgenv().Matcha.Legit.AimEnabled then
        updateCamlock()
        updateSilent()
    end
end)

-- Silent Aim Hook (Assuming hookmetamethod support)
pcall(function()
    local oldIndex = hookmetamethod(game, "__index", function(self, key)
        if not checkcaller() and getgenv().Matcha.Legit.SilentAim and Storage.CFPosition then
            if self == Mouse and (key == "Hit" or key == "Target") then
                local spoof = CFrame.new(Storage.CFPosition)
                if key == "Hit" then return spoof end
                if key == "Target" then
                    local part = Instance.new("Part")
                    part.CFrame = spoof
                    part.Transparency = 1
                    part.Anchored = true
                    part.CanCollide = false
                    part.Parent = workspace
                    delay(0.1, function() part:Destroy() end)
                    return part
                end
            end
        end
        return oldIndex(self, key)
    end)
end)
local desync_setback = Instance.new("Part")
desync_setback.Name = "DesyncSetback"
desync_setback.Size = Vector3.new(2, 2, 1)
desync_setback.CanCollide = false
desync_setback.Anchored = true
desync_setback.Transparency = 1
desync_setback.Parent = workspace

-- Anti Lock Storage
getgenv().Matcha.AntiLock = {
    Enabled = false,
    Mode = "Custom",
    Custom = { X = 0, Y = 0, Z = 0 },
    Up = { Amount = 0 },
    Down = { Amount = 0 },
    VelMultiply = { Walk = 0, Jump = 0 },
    LookVec = { Amount = 0 },
    Reverse = { Amount = 0, Type = "CFrame" },
    Confusion = { Amount = 0 },
    PredBreaker = false
}

-- Helper: Reset Camera
local function resetCamera()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        workspace.CurrentCamera.CameraSubject = LocalPlayer.Character.Humanoid
    end
end

-- Toggle Desync
local function toggleDesync()
    if getgenv().Matcha.Desync.Enabled then
        workspace.CurrentCamera.CameraSubject = desync_setback
        Library:Notification("Desync: ON [" .. getgenv().Matcha.Desync.Mode .. "]", 2)
    else
        resetCamera()
        Library:Notification("Desync: OFF", 2)
    end
end
NewConnection(RunService.Heartbeat, function()
    local target = Storage.Targets.Camlock or Storage.Targets.Silent
    if not target or not target.Character then return end

    local part = target.Character:FindFirstChild(getgenv().Matcha.Legit.HitPart or "Head")
    if not part or not isAlive(target) then return end

    if getgenv().Matcha.Legit.WallCheck and not isVisible(part) then return end

    local predicted = part.Position + (part.AssemblyLinearVelocity * (getgenv().Matcha.Legit.Prediction or 0.135))
    if getgenv().Matcha.Legit.Offset and target.Character.Humanoid:GetState() == Enum.HumanoidStateType.Freefall then
        predicted = predicted + Vector3.new(0, getgenv().Matcha.Legit.JumpOffset or 0, 0)
    end

    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    -- [VIEW TARGET] - Chỉ camera nhìn + đổi CameraSubject
    if getgenv().Matcha.Legit.ViewTarget then
        Camera.CFrame = CFrame.new(Camera.CFrame.Position, predicted)
        workspace.CurrentCamera.CameraSubject = target.Character.Humanoid
    end

    -- [LOOK AT] - Xoay nhân vật
    if getgenv().Matcha.Legit.LookAt then
        LocalPlayer.Character:SetPrimaryPartCFrame(CFrame.lookAt(hrp.Position, predicted))
    end
end)
-- Desync Heartbeat
NewConnection(RunService.Heartbeat, function()
    if not getgenv().Matcha.Desync.Enabled or not LocalPlayer.Character then 
        resetCamera() 
        return 
    end
    local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not hrp then return end

    local old = hrp.CFrame
    local pos = old.Position

    if getgenv().Matcha.Desync.Mode == "Destroy Cheaters" then
        pos = Vector3.new(9e9, 1, 1)
    elseif getgenv().Matcha.Desync.Mode == "Underground" then
        pos = pos - Vector3.new(0, 12, 0)
    elseif getgenv().Matcha.Desync.Mode == "Void Spam" then
        pos = math.random(1,2) == 1 and old.Position or Vector3.new(math.random(10000,50000), math.random(10000,50000), math.random(10000,50000))
    elseif getgenv().Matcha.Desync.Mode == "Void" then
        pos = pos + Vector3.new(math.random(-444444,444444), math.random(-444444,444444), math.random(-44444,44444))
    end

    hrp.CFrame = CFrame.new(pos)
    workspace.CurrentCamera.CameraSubject = desync_setback
    RunService.RenderStepped:Wait()
    desync_setback.CFrame = old * CFrame.new(0, hrp.Size.Y/2 + 0.5, 0)
    hrp.CFrame = old
end)

-- Anti Lock Heartbeat
NewConnection(RunService.Heartbeat, function()
    if not getgenv().Matcha.AntiLock.Enabled or not LocalPlayer.Character then return end
    local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
    if not hrp or not hum then return end

    local vel = hrp.Velocity
    local cf = hrp.CFrame

    local S = getgenv().Matcha.AntiLock

    if S.Mode == "Custom" and S.Custom.X ~= 0 or S.Custom.Y ~= 0 or S.Custom.Z ~= 0 then
        hrp.Velocity = Vector3.new(S.Custom.X, S.Custom.Y, S.Custom.Z)
        RunService.RenderStepped:Wait()
        hrp.Velocity = vel
    elseif S.Mode == "Up" and S.Up.Amount > 0 then
        hrp.Velocity = Vector3.new(vel.X, S.Up.Amount, vel.Z)
        RunService.RenderStepped:Wait()
        hrp.Velocity = vel
    elseif S.Mode == "Down" and S.Down.Amount > 0 then
        hrp.Velocity = Vector3.new(vel.X, -S.Down.Amount, vel.Z)
        RunService.RenderStepped:Wait()
        hrp.Velocity = vel
    elseif S.Mode == "VelMultiply" and (S.VelMultiply.Walk > 0 or S.VelMultiply.Jump > 0) then
        hrp.Velocity = vel * Vector3.new(S.VelMultiply.Walk, S.VelMultiply.Jump, S.VelMultiply.Walk)
        RunService.RenderStepped:Wait()
        hrp.Velocity = vel
    elseif S.Mode == "LookVec" and S.LookVec.Amount > 0 then
        hrp.Velocity = cf.lookVector * S.LookVec.Amount
        RunService.RenderStepped:Wait()
        hrp.Velocity = vel
    elseif S.Mode == "Reverse" and S.Reverse.Amount > 0 then
        if S.Reverse.Type == "CFrame" then
            hrp.CFrame = cf - hum.MoveDirection * (S.Reverse.Amount / 10)
        else
            hrp.Velocity = vel * Vector3.new(-S.Reverse.Amount/2.5, 1, -S.Reverse.Amount/2.5)
            RunService.RenderStepped:Wait()
            hrp.Velocity = vel
        end
    elseif S.Mode == "Confusion" and S.Confusion.Amount > 0 then
        hrp.CFrame = cf * CFrame.new(math.random(1,2)==1 and S.Confusion.Amount or -S.Confusion.Amount, 0, 0)
    elseif S.Mode == "PredBreaker" then
        hrp.Velocity = Vector3.zero
        RunService.RenderStepped:Wait()
        hrp.Velocity = vel
    end
end)

-- ==================== RAPID FIRE LOGIC ====================
getgenv().rapid_config = { enable = false, delay = 0 }

local utility = {}
utility.get_gun = function()
    local char = LocalPlayer.Character
    if char then
        for _, tool in pairs(char:GetChildren()) do
            if tool:IsA("Tool") and tool:FindFirstChild("Ammo") then
                return tool
            end
        end
    end
end

utility.fire = function(tool)
    if tool and tool.Parent then tool:Activate() end
end

local firing = false
UserInputService.InputBegan:Connect(function(input, gp)
    if gp or input.UserInputType ~= Enum.UserInputType.MouseButton1 then return end
    if rapid_config.enable then
        local gun = utility.get_gun()
        if gun then
            firing = true
            spawn(function()
                while firing and rapid_config.enable and utility.get_gun() == gun do
                    utility.fire(gun)
                    task.wait(rapid_config.delay)
                end
            end)
        end
    end
end)

UserInputService.InputEnded:Connect(function(input, gp)
    if gp or input.UserInputType ~= Enum.UserInputType.MouseButton1 then return end
    firing = false
end)
-- ========================================================

pcall(function()
	
local LegitTab = Window:Page({Name = "Legit", Columns = 2})
local CharacterTab = Window:Page({Name = "Character", Columns = 2})
local SettingsTab = Window:Page({Name = "Settings", Columns = 2})

-- =================================== LEGIT TAB ===================================
local AimSection = LegitTab:Section({Name = "Aim Assist", Side = 1})
local AimSetting = LegitTab:Section({Name = "Aim Settings", Side = 2})
local MiscSection = LegitTab:Section({Name = "Misc", Side = 2})

AimSection:Toggle({Name = "Aim Enabled", Flag = "AimEnabled", Default = false, Callback = function(v) getgenv().Matcha.Legit.AimEnabled = v end})
AimSection:Label("Select Target"):Keybind({Name = "SelectTargetBind", Mode = "Toggle", Callback = toggleTarget})

AimSection:Toggle({Name = "Aimlock", Flag = "Aimlock", Default = false, Callback = function(v) getgenv().Matcha.Legit.Aimlock = v end})
AimSection:Toggle({Name = "Auto Select", Flag = "AutoSelect", Default = false, Callback = function(v) getgenv().Matcha.Legit.AutoSelect = v end})
AimSection:Toggle({Name = "Silent Aim", Flag = "SilentAim", Default = false, Callback = function(v)
    getgenv().Matcha.Legit.SilentAim = v
    if v and not hookmetamethod then
        getgenv().Matcha.Legit.SilentAim = false
        Library:Notification("Warning: Executor does not support Silent Aim (hookmetamethod missing).", 5, Color3.fromRGB(255, 200, 0))
    end
end})
AimSection:Textbox({Name = "Prediction", Flag = "Prediction", Placeholder = "0.135", Callback = function(v) getgenv().Matcha.Legit.Prediction = tonumber(v) end})
AimSection:Toggle({Name = "Smoothing", Flag = "Smoothing", Default = false, Callback = function(v) getgenv().Matcha.Legit.Smoothing = v end})
AimSection:Textbox({Name = "Smoothing X", Flag = "SmoothingX", Placeholder = "0.5", Callback = function(v) getgenv().Matcha.Legit.SmoothingX = tonumber(v) end})
AimSection:Textbox({Name = "Smoothing Y", Flag = "SmoothingY", Placeholder = "0.5", Callback = function(v) getgenv().Matcha.Legit.SmoothingY = tonumber(v) end})
AimSection:Toggle({Name = "Jump Offset", Flag = "Offset", Default = false, Callback = function(v) getgenv().Matcha.Legit.Offset = v end})
AimSection:Textbox({Name = "Jump Offset Value", Flag = "JumpOffset", Placeholder = "0", Callback = function(v) getgenv().Matcha.Legit.JumpOffset = tonumber(v) end})
AimSection:Dropdown({Name = "Hit Part", Flag = "HitPart", Items = {"Head", "HumanoidRootPart", "UpperTorso", "Torso(R6)", "LowerTorso"}, Default = "Head", Callback = function(v) getgenv().Matcha.Legit.HitPart = v end})

AimSetting:Toggle({Name = "Alive Check", Flag = "AliveCheck", Default = true, Callback = function(v) getgenv().Matcha.Legit.Checks.GrabbedKnocked = v end})
AimSetting:Toggle({Name = "Wall Check", Flag = "WallCheck", Default = true, Callback = function(v) getgenv().Matcha.Legit.WallCheck = v end})
AimSetting:Toggle({Name = "Use FOV", Flag = "UseFOV", Default = false, Callback = function(v) getgenv().Matcha.Legit.UseFOV = v end}):Colorpicker({Name = "FOV Inline", Flag = "FOVInline", Default = Color3.fromRGB(255,255,255), Callback = function(v) getgenv().Matcha.Legit.FOVInline = v end})
AimSetting:Label("Fov outline"):Colorpicker({Name = "FOV Outline", Flag = "FOVOutline", Default = Color3.fromRGB(0,0,0), Callback = function(v) getgenv().Matcha.Legit.FOVOutline = v end})
AimSetting:Slider({Name = "FOV Size", Min = 1, Max = 1000, Default = 150, Flag = "FOVSize", Callback = function(v) getgenv().Matcha.Legit.FOVSize = v end})
AimSetting:Toggle({Name = "Chams Target", Flag = "Chams", Default = false, Callback = function(v) getgenv().Matcha.Legit.Chams = v end}):Colorpicker({Name = "Chams Inline", Flag = "ChamsInline", Default = Color3.fromRGB(255,255,255), Callback = function(v) getgenv().Matcha.Legit.ChamsInline = v end})
AimSetting:Label("Chams outline"):Colorpicker({Name = "Chams Outline", Flag = "ChamsOutline", Default = Color3.fromRGB(255,0,0), Callback = function(v) getgenv().Matcha.Legit.ChamsOutline = v end})


MiscSection:Toggle({Name = "Rapid Fire", Flag = "RapidFire", Default = false, Callback = function(v) rapid_config.enable = v end})
MiscSection:Slider({Name = "Rapid Delay", Min = 0, Max = 0.1, Default = 0, Decimals = 0.001, Flag = "RapidDelay", Callback = function(v) rapid_config.delay = v end})

-- =================================== CHARACTER TAB ===================================
local MovementSec = CharacterTab:Section({Name = "Movement", Side = 1})
local TeleportSec = CharacterTab:Section({Name = "Teleports", Side = 2})
local AvatarSec = CharacterTab:Section({Name = "Avatar Changer", Side = 1})
local AnimSec = CharacterTab:Section({Name = "Animations", Side = 2})
local AntiAimSec = CharacterTab:Section({Name = "Anti Aim", Side = 1})
local AntiAimSec2 = CharacterTab:Section({Name = "Anti Aim 2", Side = 2})
local ESPSec = CharacterTab:Section({Name = "ESP", Side = 1})
local WorldSec = CharacterTab:Section({Name = "World", Side = 2})

MovementSec:Toggle({Name = "WalkSpeed", Flag = "WalkSpeed", Default = false, Callback = function(v) getgenv().Matcha.Character.WalkSpeed = v end})
MovementSec:Label("WalkSpeed Key"):Keybind({Mode = "Toggle", Callback = function() Library.Flags["WalkSpeed"] = not Library.Flags["WalkSpeed"] getgenv().Matcha.Character.WalkSpeed = Library.Flags["WalkSpeed"] end})
MovementSec:Slider({Name = "WalkSpeed Value", Min = 16, Max = 300, Default = 50, Flag = "WalkSpeedValue", Callback = function(v) getgenv().Matcha.Character.WalkSpeedValue = v end})
MovementSec:Toggle({Name = "Fly", Flag = "Fly", Default = false, Callback = function(v) getgenv().Matcha.Character.Fly = v toggleFly(v) end}):Keybind({Mode = "Toggle", Callback = function() Library.Flags["Fly"] = not Library.Flags["Fly"] getgenv().Matcha.Character.Fly = Library.Flags["Fly"] toggleFly(Library.Flags["Fly"]) end})
MovementSec:Slider({Name = "Fly Speed", Min = 10, Max = 500, Default = 50, Flag = "FlySpeed", Callback = function(v) getgenv().Matcha.Character.FlySpeed = v end})
MovementSec:Toggle({Name = "CFrame Speed", Flag = "CFrameSpeed", Default = false, Callback = function(v) getgenv().Matcha.Character.CFrameSpeed = v end}):Keybind({Mode = "Toggle", Callback = function() Library.Flags["CFrameSpeed"] = not Library.Flags["CFrameSpeed"] getgenv().Matcha.Character.CFrameSpeed = Library.Flags["CFrameSpeed"] end})
MovementSec:Slider({Name = "CFrame Speed Value", Min = 10, Max = 500, Default = 50, Flag = "CFrameSpeedValue", Callback = function(v) getgenv().Matcha.Character.CFrameSpeedValue = v end})
MovementSec:Toggle({Name = "Anti Slowdown", Flag = "AntiSlow", Default = false, Callback = function(v) getgenv().Matcha.Character.AntiSlow = v toggleAntiSlow(v) end})
MovementSec:Toggle({Name = "No Jump Cooldown", Flag = "NoJumpCooldown", Default = false, Callback = function(v) getgenv().Matcha.Character.NoJumpCooldown = v end})
MovementSec:Button({Name = "TP to Target", Callback = function()
    local target = Storage.Targets.Camlock or Storage.Targets.Silent
    if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
        local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root then root.CFrame = target.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0) end
    else Library:Notification("No target selected!", 2) end
end})

TeleportSec:Button({Name = "Admin Base", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-797.15, -39.6189, -887.957) end})
TeleportSec:Button({Name = "Food Shop [Bank]", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-335.141, 23.7129, -298.029) end})
TeleportSec:Button({Name = "Food Shop [Uphill]", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(298.477, 49.3129, -615.231) end})
TeleportSec:Button({Name = "Food Shop [Taco]", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(583.96, 51.0917, -479.596) end})
TeleportSec:Button({Name = "Food Shop [Hamburger]", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-279.501, 22.6801, -803.887) end})
TeleportSec:Button({Name = "Gun Shop [Uphill]", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(481.925, 48.1008, -621.23) end})
TeleportSec:Button({Name = "Gun Shop [Armor]", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-580.27, 8.34504, -734.832) end})
TeleportSec:Button({Name = "Bank", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-438.689, 39.0127, -284.731) end})
TeleportSec:Button({Name = "Police Station", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-263.919, 21.8302, -112.858) end})
TeleportSec:Button({Name = "Fire Department", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-129.534, 27.842, -113.062) end})
TeleportSec:Button({Name = "Church", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(205.53, 21.7803, -80.2361) end})
TeleportSec:Button({Name = "Casino", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-904.457, 24.7803, -156.994) end})
TeleportSec:Button({Name = "School", Callback = function() LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(-578, 22, 337) end})
TeleportSec:Button({Name = "Save Waypoint", Callback = function()
    local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if hrp then Waypoint.Position = hrp.Position Library:Notification("Waypoint saved!", 2, Color3.fromRGB(0,255,0)) else Library:Notification("No character!", 2, Color3.fromRGB(255,0,0)) end
end})
TeleportSec:Button({Name = "Go to Waypoint", Callback = function()
    if Waypoint.Position then
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then hrp.CFrame = CFrame.new(Waypoint.Position) Library:Notification("Teleported to waypoint!", 2, Color3.fromRGB(0,255,0)) end
    else Library:Notification("No waypoint saved!", 2, Color3.fromRGB(255,0,0)) end
end})

AvatarSec:Toggle({Name = "Headless (Client)", Flag = "Headless", Default = false, Callback = function(v) getgenv().Matcha.Avatar.Headless = v applyHeadless(v) end})
AvatarSec:Toggle({Name = "Korblox (Client)", Flag = "Korblox", Default = false, Callback = function(v) getgenv().Matcha.Avatar.Korblox = v applyKorblox(v) end})
AvatarSec:Toggle({Name = "Blizzard Beast Mode", Flag = "BlizzardFace", Default = false, Callback = function(v) getgenv().Matcha.Avatar.Face.Blizzard = v if v then setFace("209712379") end end})
AvatarSec:Toggle({Name = "Super Super Happy Face", Flag = "SuperHappyFace", Default = false, Callback = function(v) getgenv().Matcha.Avatar.Face.SuperHappy = v if v then setFace("494290547") end end})
AvatarSec:Toggle({Name = "Beast Mode", Flag = "BeastFace", Default = false, Callback = function(v) getgenv().Matcha.Avatar.Face.Beast = v if v then setFace("127959433") end end})
AvatarSec:Toggle({Name = "Playful Vampire", Flag = "VampireFace", Default = false, Callback = function(v) getgenv().Matcha.Avatar.Face.Vampire = v if v then setFace("2409281591") end end})

AnimSec:Button({Name = "Zombie T/OM", Callback = function()
    local animate = LocalPlayer.Character.Animate
    animate.idle.Animation1.AnimationId = "http://www.roblox.com/asset/?id=782841498"
    animate.idle.Animation2.AnimationId = "http://www.roblox.com/asset/?id=782845736"
    animate.walk.WalkAnim.AnimationId = "http://www.roblox.com/asset/?id=616168032"
    animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=616163682"
    animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=5319841935"
    animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=707829716"
    LocalPlayer.Character.Humanoid.Jump = true
end})
AnimSec:Button({Name = "Zombie T/M", Callback = function()
    local animate = LocalPlayer.Character.Animate
    animate.idle.Animation1.AnimationId = "http://www.roblox.com/asset/?id=782841498"
    animate.idle.Animation2.AnimationId = "http://www.roblox.com/asset/?id=782845736"
    animate.walk.WalkAnim.AnimationId = "http://www.roblox.com/asset/?id=616168032"
    animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=616163682"
    animate.jump.JumpAnim.AnimationId = "http://www.roblox.com/asset/?id=1083218792"
    animate.fall.FallAnim.AnimationId = "http://www.roblox.com/asset/?id=707829716"
    LocalPlayer.Character.Humanoid.Jump = true
end})
AnimSec:Button({Name = "Zombie Run/Walk", Callback = function()
    local animate = LocalPlayer.Character.Animate
    animate.walk.WalkAnim.AnimationId = "http://www.roblox.com/asset/?id=616168032"
    animate.run.RunAnim.AnimationId = "http://www.roblox.com/asset/?id=616163682"
    LocalPlayer.Character.Humanoid.Jump = true
end})

AntiAimSec:Toggle({Name = "Desync", Flag = "DesyncEnabled", Default = false, Callback = function(v) getgenv().Matcha.Desync.Enabled = v end})
AntiAimSec:Label("Desync Key"):Keybind({Mode = "Toggle", Callback = function() Library.Flags["DesyncEnabled"] = not Library.Flags["DesyncEnabled"] getgenv().Matcha.Desync.Enabled = Library.Flags["DesyncEnabled"] end})
AntiAimSec:Dropdown({Name = "Desync Mode", Flag = "DesyncMode", Items = {"Destroy Cheaters", "Underground", "Void Spam", "Void"}, Default = "Void", Callback = function(v) getgenv().Matcha.Desync.Mode = v end})
AntiAimSec:Toggle({Name = "Anti Lock", Flag = "AntiLockEnabled", Default = false, Callback = function(v) getgenv().Matcha.AntiLock.Enabled = v end})
AntiAimSec:Label("Anti Lock Key"):Keybind({Mode = "Toggle", Callback = function() Library.Flags["AntiLockEnabled"] = not Library.Flags["AntiLockEnabled"] getgenv().Matcha.AntiLock.Enabled = Library.Flags["AntiLockEnabled"] end})
AntiAimSec:Dropdown({Name = "Anti Lock Mode", Flag = "AntiLockMode", Items = {"Custom", "Up", "Down", "VelMultiply", "LookVec", "Reverse", "Confusion", "PredBreaker"}, Default = "Custom", Callback = function(v) getgenv().Matcha.AntiLock.Mode = v end})
AntiAimSec:Label("Custom")
AntiAimSec:Slider({Name = "X", Min = -10000, Max = 10000, Default = 0, Flag = "CustomX", Callback = function(v) getgenv().Matcha.AntiLock.Custom.X = v end})
AntiAimSec:Slider({Name = "Y", Min = -10000, Max = 10000, Default = 0, Flag = "CustomY", Callback = function(v) getgenv().Matcha.AntiLock.Custom.Y = v end})
AntiAimSec:Slider({Name = "Z", Min = -10000, Max = 10000, Default = 0, Flag = "CustomZ", Callback = function(v) getgenv().Matcha.AntiLock.Custom.Z = v end})
AntiAimSec:Label("Up")
AntiAimSec:Slider({Name = "Amount", Min = 1, Max = 10000, Default = 100, Flag = "UpAmount", Callback = function(v) getgenv().Matcha.AntiLock.Up.Amount = v end})
AntiAimSec2:Label("Down")
AntiAimSec2:Slider({Name = "Amount", Min = 1, Max = 10000, Default = 100, Flag = "DownAmount", Callback = function(v) getgenv().Matcha.AntiLock.Down.Amount = v end})
AntiAimSec2:Label("VelMultiply")
AntiAimSec2:Textbox({Name = "Walk Amt", Placeholder = "1.5", Flag = "VelWalk", Callback = function(v) getgenv().Matcha.AntiLock.VelMultiply.Walk = tonumber(v) or 0 end})
AntiAimSec2:Textbox({Name = "Jump Amt", Placeholder = "1.0", Flag = "VelJump", Callback = function(v) getgenv().Matcha.AntiLock.VelMultiply.Jump = tonumber(v) or 0 end})
AntiAimSec2:Label("LookVec")
AntiAimSec2:Slider({Name = "Amount", Min = 1, Max = 10000, Default = 500, Flag = "LookVecAmt", Callback = function(v) getgenv().Matcha.AntiLock.LookVec.Amount = v end})
AntiAimSec2:Label("Reverse")
AntiAimSec2:Slider({Name = "Amount", Min = 1, Max = 10000, Default = 50, Flag = "ReverseAmt", Callback = function(v) getgenv().Matcha.AntiLock.Reverse.Amount = v end})
AntiAimSec2:Dropdown({Name = "Type", Flag = "ReverseType", Items = {"CFrame", "Velocity"}, Default = "CFrame", Callback = function(v) getgenv().Matcha.AntiLock.Reverse.Type = v end})
AntiAimSec2:Label("Confusion")
AntiAimSec2:Slider({Name = "Amount", Min = 1, Max = 10000, Default = 5, Flag = "ConfusionAmt", Callback = function(v) getgenv().Matcha.AntiLock.Confusion.Amount = v end})

ESPSec:Toggle({Name = "Enabled", Flag = "ESPEnabled", Default = false, Callback = function(v) getgenv().Matcha.ESP.Enabled = v end}):Colorpicker({Name = "Color", Flag = "ESPColor", Default = Color3.fromRGB(255,255,255), Callback = function(v) getgenv().Matcha.ESP.Color = v end})
ESPSec:Toggle({Name = "Names", Flag = "NameESP", Default = false, Callback = function(v) getgenv().Matcha.ESP.NameEnabled = v end}):Colorpicker({Name = "Name Color", Flag = "NameColor", Default = Color3.fromRGB(255,255,255), Callback = function(v) getgenv().Matcha.ESP.NameColor = v end})
ESPSec:Dropdown({Name = "Name Mode", Flag = "NameMode", Items = {"Username", "DisplayName", "Username (DisplayName)", "Username (DisplayName) [UserID]"}, Default = "DisplayName", Callback = function(v) getgenv().Matcha.ESP.NameMode = v end})
ESPSec:Toggle({Name = "Health Bar", Flag = "HealthBar", Default = false, Callback = function(v) getgenv().Matcha.ESP.HealthBar = v end}):Colorpicker({Name = "Health Color", Flag = "HealthColor", Default = Color3.fromRGB(0,255,0), Callback = function(v) getgenv().Matcha.ESP.HealthColor = v end})
ESPSec:Toggle({Name = "Distance", Flag = "DistanceESP", Default = false, Callback = function(v) getgenv().Matcha.ESP.DistanceEnabled = v end}):Colorpicker({Name = "Distance Color", Flag = "DistanceColor", Default = Color3.fromRGB(255,255,255), Callback = function(v) getgenv().Matcha.ESP.DistanceColor = v end})
ESPSec:Toggle({Name = "Weapon ESP", Flag = "WeaponESP", Default = false, Callback = function(v) getgenv().Matcha.ESP.WeaponEnabled = v end}):Colorpicker({Name = "Weapon Color", Flag = "WeaponColor", Default = Color3.fromRGB(255,255,255), Callback = function(v) getgenv().Matcha.ESP.WeaponColor = v end})
ESPSec:Toggle({Name = "Armor Bar", Flag = "ArmorBar", Default = false, Callback = function(v) getgenv().Matcha.ESP.ArmorBar = v end}):Colorpicker({Name = "Armor Color", Flag = "ArmorColor", Default = Color3.fromRGB(0,0,255), Callback = function(v) getgenv().Matcha.ESP.ArmorColor = v end})
ESPSec:Toggle({Name = "Outline", Flag = "OutlineESP", Default = false, Callback = function(v) getgenv().Matcha.ESP.Outline = v end})
ESPSec:Toggle({Name = "Penis ESP", Flag = "PenisESP", Default = false, Callback = function(v) getgenv().Matcha.ESP.PenisEnabled = v end}):Colorpicker({Name = "Penis Color", Flag = "PenisColor", Default = Color3.fromRGB(255,0,0), Callback = function(v) getgenv().Matcha.ESP.PenisColor = v end})

WorldSec:Toggle({Name = "Ambient Changer", Flag = "AmbientEnabled", Default = false, Callback = function(v) if v then Lighting.Ambient = getgenv().Matcha.World.AmbientColor else Lighting.Ambient = Original.Ambient end end}):Colorpicker({Name = "Ambient Color", Flag = "AmbientColor", Default = Original.Ambient, Callback = function(v) getgenv().Matcha.World.AmbientColor = v if Library.Flags["AmbientEnabled"] then Lighting.Ambient = v end end})
WorldSec:Toggle({Name = "Fog Changer", Flag = "FogEnabled", Default = false, Callback = function(v) if v then Lighting.FogColor = getgenv().Matcha.World.FogColor Lighting.FogStart = getgenv().Matcha.World.FogStart Lighting.FogEnd = getgenv().Matcha.World.FogEnd else Lighting.FogColor = Original.FogColor Lighting.FogStart = Original.FogStart Lighting.FogEnd = Original.FogEnd end end}):Colorpicker({Name = "Fog Color", Flag = "FogColor", Default = Original.FogColor, Callback = function(v) getgenv().Matcha.World.FogColor = v if Library.Flags["FogEnabled"] then Lighting.FogColor = v end end})
WorldSec:Slider({Name = "Fog Start", Min = 1, Max = 1000, Default = Original.FogStart, Flag = "FogStart", Callback = function(v) getgenv().Matcha.World.FogStart = v if Library.Flags["FogEnabled"] then Lighting.FogStart = v end end})
WorldSec:Slider({Name = "Fog End", Min = 1, Max = 10000, Default = Original.FogEnd, Flag = "FogEnd", Callback = function(v) getgenv().Matcha.World.FogEnd = v if Library.Flags["FogEnabled"] then Lighting.FogEnd = v end end})
WorldSec:Slider({Name = "Time Changer", Min = 0, Max = 24, Default = Original.ClockTime, Decimals = 2, Flag = "TimeValue", Callback = function(v) Lighting.ClockTime = v end})

-- =================================== SETTINGS TAB ===================================
getgenv().ConfigFolder = "Matcha"

local ThemesSection = SettingsTab:Section({ Name = "Themes", Side = 1 }) do
    for Index, Value in Library.Theme do
        Library.ThemeColorpickers[Index] = ThemesSection:Label(Index, "Left"):Colorpicker({ Name = Index, Flag = "Theme" .. Index, Default = Value, Callback = function(Value) Library.Theme[Index] = Value Library:ChangeTheme(Index, Value) end })
    end
    ThemesSection:Dropdown({Name = "Themes list", Items = {"Default", "Bitchbot", "Onetap", "Aqua"}, Default = "Default", Callback = function(Value)
        local ThemeData = Library.Themes[Value]
        if not ThemeData then return end
        for Index, Value in Library.Theme do
            Library.Theme[Index] = ThemeData[Index]
            Library:ChangeTheme(Index, ThemeData[Index])
            Library.ThemeColorpickers[Index]:Set(ThemeData[Index])
        end
        task.wait(0.3)
        Library:Thread(function()
            for Index, Value in Library.Theme do
                Library.Theme[Index] = Library.Flags["Theme"..Index].Color
                Library:ChangeTheme(Index, Library.Flags["Theme"..Index].Color)
            end
        end)
    end})
    local ThemeName
    local SelectedTheme
    local ThemesListbox = ThemesSection:Listbox({ Name = "Themes List", Flag = "Themes List", Items = { }, Multi = false, Default = nil, Callback = function(Value) SelectedTheme = Value end })
    ThemesSection:Textbox({ Name = "Name", Flag = "Theme Name", Default = "", Placeholder = ". . .", Callback = function(Value) ThemeName = Value end })
    ThemesSection:Button({ Name = "Save Theme", Callback = function()
        if ThemeName == "" then return end
        if not isfile(Library.Folders.Themes .. "/" .. ThemeName .. ".json") then
            writefile(Library.Folders.Themes .. "/" .. ThemeName .. ".json", Library:GetTheme())
            Library:RefreshThemeList(ThemesListbox)
        else
            Library:Notification("Theme '" .. ThemeName .. ".json' already exists", 3, Color3.fromRGB(255, 0, 0))
            return
        end
    end }):SubButton({ Name = "Load Theme", Callback = function()
        if SelectedTheme then Library:LoadTheme(readfile(Library.Folders.Themes .. "/" .. SelectedTheme)) end
    end })
    ThemesSection:Button({ Name = "Refresh Themes", Callback = function() Library:RefreshThemeList(ThemesListbox) end })
    Library:RefreshThemeList(ThemesListbox)
end

local ConfigsSection = SettingsTab:Section({ Name = "Configs", Side = 2 }) do
    local ConfigName
    local SelectedConfig
    local ConfigsListbox = ConfigsSection:Listbox({ Name = "Configs list", Flag = "Configs List", Items = { }, Multi = false, Default = nil, Callback = function(Value) SelectedConfig = Value end })
    ConfigsSection:Textbox({ Name = "Name", Flag = "Config Name", Default = "", Placeholder = ". . .", Callback = function(Value) ConfigName = Value end })
    ConfigsSection:Button({ Name = "Load Config", Callback = function()
        if SelectedConfig then Library:LoadConfig(readfile(Library.Folders.Configs .. "/" .. SelectedConfig)) end
        Library:Thread(function()
            task.wait(0.1)
            for Index, Value in Library.Theme do
                Library.Theme[Index] = Library.Flags["Theme"..Index].Color
                Library:ChangeTheme(Index, Library.Flags["Theme"..Index].Color)
            end
        end)
    end }):SubButton({ Name = "Save Config", Callback = function()
        if SelectedConfig then Library:SaveConfig(SelectedConfig) end
    end })
    ConfigsSection:Button({ Name = "Create Config", Callback = function()
        if ConfigName == "" then return end
        if not isfile(Library.Folders.Configs .. "/" .. ConfigName .. ".json") then
            writefile(Library.Folders.Configs .. "/" .. ConfigName .. ".json", Library:GetConfig())
            Library:RefreshConfigsList(ConfigsListbox)
        else
            Library:Notification("Config '" .. ConfigName .. ".json' already exists", 3, Color3.fromRGB(255, 0, 0))
            return
        end
    end }):SubButton({ Name = "Delete Config", Callback = function()
        if SelectedConfig then Library:DeleteConfig(SelectedConfig) Library:RefreshConfigsList(ConfigsListbox) end
    end })
    ConfigsSection:Button({ Name = "Refresh Configs", Callback = function() Library:RefreshConfigsList(ConfigsListbox) end })
    Library:RefreshConfigsList(ConfigsListbox)
    ConfigsSection:Label("Menu Keybind", "Left"):Keybind({Name = "Menu Keybind", Flag = "Menu Keybind", Default = Enum.KeyCode.End, Mode = "Toggle", Callback = function(Value) Library.MenuKeybind = Library.Flags["Menu Keybind"].Key end})
    ConfigsSection:Toggle({Name = "Watermark", Flag = "Watermark", Default = false, Callback = function(v) Watermark:SetVisibility(v) end})
    ConfigsSection:Toggle({Name = "Keybind List", Flag = "KeybindList", Default = false, Callback = function(v) KeybindList:SetVisibility(v) end})
    ConfigsSection:Dropdown({Name = "Style", Flag = "TweenStyle", Default = "Exponential", Items = {"Linear", "Sine", "Quad", "Cubic", "Quart", "Quint", "Exponential", "Circular", "Back", "Elastic", "Bounce"}, Callback = function(v) Library.Tween.Style = Enum.EasingStyle[v] end})
    ConfigsSection:Dropdown({Name = "Direction", Flag = "TweenDir", Default = "Out", Items = {"In", "Out", "InOut"}, Callback = function(v) Library.Tween.Direction = Enum.EasingDirection[v] end})
    ConfigsSection:Slider({Name = "Tween Time", Min = 0, Max = 5, Default = 0.25, Decimals = 0.01, Flag = "TweenTime", Callback = function(v) Library.Tween.Time = v end})
    ConfigsSection:Button({Name = "Notification test", Callback = function() Library:Notification("Test noti!", 5, Color3.fromRGB(0,255,0)) end})
    ConfigsSection:Button({Name = "Unload library", Callback = function() Library:Unload() end})
    ConfigsSection:Button({Name = "Rejoin Server", Callback = function() game:GetService("TeleportService"):Teleport(game.PlaceId, LocalPlayer) end})
    ConfigsSection:Button({Name = "Server Hop", Callback = function()
        local Servers = {}
        local cursor = ""
        local success, response
        repeat
            success, response = pcall(function()
                return game:GetService("HttpService"):JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100" .. (cursor ~= "" and "&cursor=" .. cursor or "")))
            end)
            if success and response and response.data then
                for _, server in response.data do
                    if server.playing < server.maxPlayers and server.id ~= game.JobId then table.insert(Servers, server.id) end
                end
                cursor = response.nextPageCursor or ""
            else break end
        until cursor == ""
        if #Servers > 0 then game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, Servers[math.random(1, #Servers)], LocalPlayer) else Library:Notification("Ko tim thay server!", 3) end
    end})
end

LocalPlayer.CharacterAdded:Connect(function(char)
    task.wait(1)
    if getgenv().Matcha.Avatar.Headless then applyHeadless(true) end
    if getgenv().Matcha.Avatar.Korblox then applyKorblox(true) end
end)

Library:Notification("Matcha Freemium loaded! Rapid Fire ready.", 5, Color3.fromRGB(0,255,0))
end)
